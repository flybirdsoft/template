/************************************************
编写：邬畏畏
blogs:www.cnblogs.com/wsoft
功能：模板处理
*************************************************/
!function(t,e,i,n){window.template={_startSymbol:"\\${",_endSymbol:"}",templateElement:{},contentNode:null},window.T=window.template=template,template.startSymbol=function(t){var e,i="",n="^$*+?{}[]|.";for(e=0;e<t.length;e++)n.indexOf(t.substr(e,1))>=0&&(i+="\\"),i+=t.substr(e,1);this._startSymbol=i},template.endSymbol=function(t){var e,i="",n="^$*+?{}[]|.";for(e=0;e<t.length;e++)n.indexOf(t.substr(e,1))>=0&&(i+="\\"),i+=t.substr(e,1);this._endSymbol=t},template.repeat=function(t){if(void 0==t.data)throw new Error("参数名称不对,参数是{},缺少data");if(void 0==t.repeatId&&void 0==t.id)throw new Error("参数名称不对,参数是{},缺少id或repeatId");var e,i,n,o,r,a,l,d,r,s,p,m,b={string:""},g=[],c=(t.id||t.repeatId,null),f=function(){},u={},y={},h=null,S="";for(a=$(t.id)[0]||$(t.repeatId)[0],l=a.parentNode,template.deleteNode(a),void 0==t.template&&(t.template=a.innerHTML),void 0==t.data.length?(n=1,g[0]=t.data):(n=t.data.length,g=t.data),void 0!=t.count&&(n=t.count),void 0!=t.process&&(f=t.process||t.onprocess),c=a,e=n-1;e>=0;e--){for(u={index:e,item:g[e]},d=f.call(this,u),h=document.createElement(a.nodeName),i=0;i<a.attributes.length;i++){S=a.attributes.item(i).value;for(r in d)p=this._startSymbol+r+this._endSymbol,m=new RegExp(p,"g"),S=S.replace(m,d[r]);h.setAttribute(a.attributes.item(i).name,S)}b.string=t.template,o=g[e];for(r in d)"object"!=typeof d[r]?(p=this._startSymbol+r+this._endSymbol,m=new RegExp(p,"g"),b.string=b.string.replace(m,d[r])):template.getScope(d,r,b);for(r in o)"object"!=typeof o[r]?(p=this._startSymbol+r+this._endSymbol,m=new RegExp(p,"g"),b.string=b.string.replace(m,o[r])):template.getScope(o,r,b);h.innerHTML=b.string,l.insertBefore(h,c.nextSibling),h.style.display="block",h.setAttribute("templateItem","templateItem")}a.style.display="none",void 0!=t.bind&&(y.target=$(t.id)[0],y.data=t.data,y.template=t.template,y.id=t.id,s=t.bind.call(this,y))},template.getScope=function(t,e,i,n){var o,r,a="";if(r=t[e],"object"==typeof r){a=void 0==n?e:n;for(o in r){if(a+="."+o,"object"==typeof r[o])return void this.getScope(r,o,i,a);strV=this._startSymbol+a+this._endSymbol,reg=new RegExp(strV,"g"),i.string=i.string.replace(reg,r[o])}}},template.deleteNode=function(t){for(var e,i=t.nextSibling,n=1==i.nodeType&&"templateItem"==i.getAttribute("templateItem")||1!=i.nodeType;null!=i&&n;)e=i.nextSibling,i.parentNode.removeChild(i),i=e}}(window,void 0,void 0,location);